# Game Theory-based Scalable Offloading in Vehicular Edge Computing: A Neural Network Based Transfer Learning Approach 
- 车辆边缘计算中基于博弈论的可扩展卸载：一种基于神经网络的迁移学习方法 
# 背景
- 随着自动驾驶汽车(autonomous vehicles, AVs)、车辆网络和移动边缘计算(mobile edge computing, MEC)的快速发展，车辆边缘计算(vehicle edge computing, VEC)以其在驾驶安全、便捷、高效等方面的服务而备受关注。VEC的卸载对AVs的能耗、VEC应用的性能、网络运营商的收入、AVs的成本等都有重要影响。VEC中的许多卸载问题已经被研究，但由于AVs数量的大量增加和VEC环境的时变变化，在可扩展性方面仍然存在挑战。迫切需要满足卸载的可扩展性要求，以便根据各种技术参数灵活部署AV服务等VEC应用程序。因此，可扩展的卸载优化在VEC中有着深远的意义。
- 存在问题：
  1. 目前的可扩展卸载优化方法是基于规划、架构设计、部署控制等方面。**缺乏一种同时考虑VEC中能量消耗、延迟、网络运营商收益等要素**的有效方法来提高卸载策略的可扩展性性能。
  2. 博弈论已被广泛应用于解决VEC中卸载的优化问题。但求解博弈论模型通常需要大量的迭代，**导致计算复杂度和能量消耗较高。如果场景发生变化，博弈论模型将需要重新求解**。
  3. 在复杂多变的VEC环境中，AVs数据采集具有局限性，**使得很难获得足够的数据**，导致神经网络等深度学习方法在VEC中难以进行可扩展的卸载优化。
- 解决方法：
  1. 基于Stackelberg博弈框架，提出了VEC卸载决策的**两阶段博弈模型**，它考虑了网络运营商与AVS之间互动的商业模型。 
  2. 提出了一种基于**神经网络**的博弈模型，利用了概率调节/贝叶斯算法。可以捕捉博弈模型的求解过程，拟合并进一步推导出卸载决策过程数据集的概率分布。
  3. 将**迁移学习**应用于VEC中博弈论卸载的可扩展优化。通过特征变换找到共同的潜在特征，并将其作为传递知识的桥梁。
- 因此，在本研究中的目标是有效地求解博弈论模型，并在变化的VEC环境中实现可扩展性。首先建立了车辆卸载决策的两阶段博弈模型，该模型考虑了运营商的收益、能耗和延迟。然后设计一个神经网络模型来学习所建立的博弈模型的预测行为，以更有效的方式进行卸载决策。在此基础上，提出了一种基于特征的迁移学习算法，用于未知VEC环境下的可扩展卸载优化。
# 相关知识
- 博弈论：模型中通常包含三个关键元素，包括玩家、策略和效用(也称为收益)。博弈过程可以描述为参与者根据对手的策略进行博弈，以最大化参与者的收益和博弈系统为目标。一旦目标达成，博弈模型的权衡应该达到一个被称为纳什均衡的点。
- 纳什均衡：类似于达到了最优解。这是指的游戏中的一个状态，在这个状态下，在其他玩家决策不变的情况下，如果任何一个玩家改变当下的决策，都无法得到更多的好处。
- Stackelberg博弈：主要思想是双方都是根据对方可能的策略来选择自己的策略以保证自己在对方策略下的利益最大化，从而达到纳什均衡。在该博弈模型中，先作出决策的一方被称为leader，在leader之后，剩余的players根据leader的决策进行决策，被称为followers，然后leader再根据followers的决策对自己的决策进行调整，如此往复，直到达到纳什均衡。
- Scalability：可扩展性是指系统、网络或进程处理不断增长的工作量的能力，这可以通过移动边缘计算中的计算卸载来实现。
- 迁移学习：迁移学习(Transfer Learning)是机器学习中解决训练数据不足带来的问题的重要工具，就是把为任务 A 开发的模型作为初始点，重新使用在为任务 B 开发模型的过程中。找到目标问题的相似性，迁移学习任务就是从相似性出发，将旧领域(domain)学习过的模型应用在新领域上。
# 系统模型
<div align=center><img width="450" src="https://user-images.githubusercontent.com/121794362/228477121-8a1c33aa-30cf-4349-8220-f97353eaaf4d.png" align="centering"/><br/>
  <span>图1 AVs卸载决策的可扩展性需求框架</span></div>

- 系统框架如图1所示，由源域𝐷S中的若干AVs、目标域𝐷𝑇中的若干AVs和一个共享基站组成。𝐷S和𝐷𝑇中的AVs处于同一网络覆盖区域。首先由DS中的AVs实现卸载策略，通过考虑𝐷T的AVs及其驾驶环境的特征，然后将影响卸载策略的能耗、时延和成本等特性转移到DT的AVS中，实现VEC卸载的可扩展优化。
## A.博弈论模型
- 设𝑉𝑠需要处理一个由{𝑥，𝑐𝑉𝑠，𝑇𝑚𝑎𝑥}表示的任务，其中𝑥∈[0，X]是要确定是否卸载到VEC的数据大小，X是数据大小的上限。𝑐𝑉𝑠表示处理任务𝑥的计算需求，例如所需的CPU周期数。𝑇𝑚𝑎𝑥表示延迟需求的上限。
<div align=center><img width="335" alt="2" src="https://user-images.githubusercontent.com/121794362/228485747-908c2b56-559d-4468-8d23-93a3ed8b8c7c.png"></div>

### 1.本地计算
- 本地执行任务的成本:<img width="200" alt="本地计算成本" src="https://user-images.githubusercontent.com/121794362/228482850-71352aa4-d898-45a0-a373-44166f5ce96c.png#pic_center">
### 2.车辆边缘计算
- 考虑时延和能耗的VEC传输和计算的总成本：<img width="215" alt="VEC成本" src="https://user-images.githubusercontent.com/121794362/228485937-63c765ac-7361-4d88-98d8-abd9a447eb87.png">
- 在任务𝑥上花费的总成本：<img width="168" alt="总成本" src="https://user-images.githubusercontent.com/121794362/228485865-40165a8b-bef2-499c-b5ff-7e16038c4aec.png">
### 3.两阶段博弈理论模型
  <div align=center><img width="515" src="https://user-images.githubusercontent.com/121794362/228513983-cef82c11-7e7f-4295-80cc-09c022ffbbfb.png"><br/><span>图2 利用神经网络求解博弈理论卸载决策过程</span></div>
  
- 价格首先由网络运营商作为𝐷𝑠中𝑉𝑠的卸载请求的响应进行单播。收到报价后，𝑉𝑠将以其可接受的价格𝜋回应VEC运营商。根据这一过程，运营商将在下一轮报价中更新其报价。在满足𝑉𝑠的成本最小化要求的同时，通过不断的迭代，可以达到一个促进运营商收入最大化的最优价格。但是，如果价格不能收敛到一个平衡点，即经过多次迭代，价格不能达成一致，则通信服务请求将被网络运营商拒绝，VEC服务停止。𝜋为网络运营商提供VEC服务的价格，𝑥为需要卸载的数据量。
- Stage 1 sub-game (Leader)：Pricing and revenue maximization
  - 网络运营商的收益最大化问题可以表示为：<img width="152" alt="最大化收益" src="https://user-images.githubusercontent.com/121794362/228501162-931661b2-b878-4d54-82fc-c87081aa2546.png">
  - 可以看出，运营商通过VEC提供服务的收益最大化可以通过最小化能量成本 ${𝐸}^{𝐸𝐶}_{𝑉𝑠}$ 和最大化价格𝜋来实现。
- Stage 2 sub-game (Follower)：Cost minimization and offloading strategy
  
  - 期望总成本将尽可能降低，成本最小化问题可以表示为：
    <div align=center><img width="327" alt="最小化成本" src="https://user-images.githubusercontent.com/121794362/228500011-e0da038a-53f8-48f5-83b6-1bbaa4364dea.png"></div>
  - 从网络经济的角度出发，假设在通信和计算上花费的单位能量的价格为𝑝𝑒，这在网络运营商之间是一致的。因此，传输和交换的总费用可以表示为：<img width="215" alt="成本" src="https://user-images.githubusercontent.com/121794362/228500461-13cbef30-daa6-4fd1-bdb5-5f512b62814b.png">
 
## B.纳什均衡
1. Leader’s Game – Stage 1：在这一阶段，将定价策略、能源成本和延迟纳入到网络运营商的收益中，作为下一阶段博弈的Follower的输入信息。
- 假设在具有最优𝑥∗和𝜋∗的卸载决策中存在纳什均衡，它们分别代表最优数据大小和运营商提供的最优价格。如果以下条件成立，则（𝑥∗，𝜋∗）应该在这个博弈的平衡点上
<div align=center><img width="276" alt="1920" src="https://user-images.githubusercontent.com/121794362/228536169-66f249a7-9e91-4273-b9be-aa5b33678bee.png"></div>

2. Follower’s Game – Stage 2：Follower的成本被描述为：
<div align=center><img width="218" alt="30" src="https://user-images.githubusercontent.com/121794362/228536289-391da536-f151-49c1-bb3c-9f4ba54c5641.png"></div>
 
- 其中，𝐶∗是通信和计算服务的最小成本，𝐸∗和𝑝𝑒∗分别代表最优的能耗和商定的价格，该函数中包含了卸载数据的大小。
<div align=center><img width="344" alt="算法1" src="https://user-images.githubusercontent.com/121794362/228536451-d5ea9dd0-d2e3-4bb8-8b91-551c10c39d8b.png"><br/><span>算法1 博弈论卸载策略</span></div>


# 求解博弈论模型的神经网络 
## 背景知识
- 基于变分推断的贝叶斯神经网络
  - 贝叶斯神经网络不同于一般的神经网络，其权重参数是**随机变量**，而非确定的值。
- VEC网络会随着与基站连接的车辆数量的变化而动态变化，在一组约束条件下动态实现优化目标比较棘手，采用神经网络可以有效地解决由于AVs情况变化而引起的博弈模型变化问题，具有较好的适应性。
- 变分贝叶斯法是一类用于贝叶斯估计和机器学习领域中近似计算复杂积分的技术。通过变分贝叶斯推断可以求解得到一个近似的后验概率分布去逼近真实的后验概率分布。
- 根据中心极限定理，当数据集足够大时，数据趋于高斯分布。可使用极大似然法来估测概率分布模型中的参数。
  <div align=center><img width="340" alt="算法2" src="https://user-images.githubusercontent.com/121794362/228546605-7694b390-e193-4c66-ad30-33f654d899e4.png"><br/><span>算法2 博弈论卸载-平均场变分（GTO-MFV）过程 </span></div>


# 车辆边缘计算中博弈论卸载的迁移学习
## 背景知识
- 对于上路的AVS，每一个AV都有自己的专属特性，也有与他人的共同特性。因此，一个AV的卸载决策策略可能不适用于其他AV，从而影响VEC的可扩展性。 此外，也不可能收集所有的AVS数据用于制定智能卸载策略。针对大规模边缘AVS中分布式卸载决策策略的需求，利用迁移学习方法将**源域的卸载知识迁移到目标域**，实现了VEC中博弈论卸载的可扩展优化方案。 
- 聚类(Clustering)：是指把相似的数据划分到一起，具体划分的时候并不关心这一类的标签，目标就是把相似的数据聚合到一起。
- 降维的作用：在原始的高维空间中，包含冗余信息和噪声信息，会在实际应用中引入误差，影响准确率；而降维可以提取数据内部的本质结构，减少冗余信息和噪声信息造成的误差，提高应用中的精度。
- 特征选择( Feature Selection )也称特征子集选择( Feature Subset Selection , FSS )，或属性选择( Attribute Selection )。是指从已有的M个特征(Feature)中选择N个特征使得系统的特定指标最优化，是从原始特征中选择出一些最有效特征以降低数据集维度的过程，是提高学习算法性能的一个重要手段。
## A. Features Selection
- 数据 𝑆𝑖(𝐶𝑡 𝑥, 𝜋, 𝑥, Φ) 表示为矩阵 𝑆 = [𝑆1, 𝑆2, . . . , 𝑆𝑖] ∈ 𝑅 ℎ×𝑛 , 其中 𝑆𝑖 = [𝐶𝑖𝑡 𝑥, 𝜋𝑖 , 𝑥𝑖 , Φ𝑖] 
- 投影矩阵𝑊将输入的𝑆投影到公共的𝑚维空间中，用于对不同的特征空间进行特征选择。最优的𝑊可以看作是优化问题，将线性降维问题的最优𝑊表示为：
<div align=center><img width="134" alt="46" src="https://user-images.githubusercontent.com/121794362/228559069-7ebf7ea7-db0d-4860-8ead-cfb3a68fbbc1.png"></div>

- 由于约束条件不是凸的，因此很难对上述函数进行优化。我们假设存在一个矩阵𝑊，其每列是𝑆𝑌𝑆𝑇=𝜆𝑆𝑉𝑆𝑇的一个特征向量，𝜆是特征值，因此𝑆𝑇𝑊=𝑌。因此，我们需要解决以下问题： 1)根据𝑉𝑌=𝚲𝐷𝑌计算出𝑌，其中𝚲是一个对角矩阵；2)找到满足𝑆𝑇𝑊=𝑌的𝑊。
- 在收到博弈模型的输出后，作为源数据处理的结果将被送到传输机制进行处理，如图3，步骤1所示。在该机制中，数据𝑆和𝑊涉及到一个数据图。𝑆和𝑊之间的数据的相似性预计将被学习和预测。因此，我们的目标是在源域和目标域的公共空间中为𝑆学习不同的𝑊。
<div align=center><img width="534" alt="图3" src="https://user-images.githubusercontent.com/121794362/228547474-ab233f7d-7daf-4bca-9b13-559ba1e6f3a8.png"><br/><span>图3 使用迁移学习方法的大规模 AV 的卸载决策</span></div>

- 图3上部的车辆是显示传输机制的样本，它们通过点对点网状网络相互通信(V2V)。
## B. Features Comparison and Update
<div align=center><img width="449" alt="算法3" src="https://user-images.githubusercontent.com/121794362/228547544-2282b7f7-d1c7-4257-b930-2637013022cb.png"><br/><span>算法3 迁移学习-特征选择、比较和更新（TL-FSCU）</span></div>

- 将选择的特征与目标域中存储的特征进行比较，然后对比较结果进行评估:
  - 如果选择的特征不存在，则将特征添加到目标域中进行特征映射。
  - 如果所选特征与被比较特征的相似度得分小于一个特定的阈值𝜖，则表示所选特征与被比较特征的相似度存在，不会更新特征。因此，AV在目标域的策略将被继承。否则，这些特性将更新为目标域中AV的卸载策略。
- 迁移学习机制处理后的结果发送给附近的其他车辆，如图3，步骤2所示。接着，通过步骤3、步骤4、步骤5等，将类似的过程推广到大型车辆上。

# 实验结果及分析
## A.实验设置
- 本文提出的算法GTOS和GTO-MFV是通过Matlab实现的，TL-FSCU是通过Python 3.7在基于gpu的服务器上实现的。该服务器的GPU为nvidimi 470.57.02，带有TITAN RTX和CUDA 11.4版本。CPU为Intel(R) Core(TM) i9-9960X CPU @ 3.10GHz。在实验中，我们考虑一个典型的VEC场景，在一个网络覆盖区域内，有一个基站为𝐷𝑠和𝐷𝑇中的AVs提供网络服务，也就是说𝐷𝑠中的𝑉𝑠与𝐷𝑇中的𝑉𝑇具有相同的网络环境。𝑉𝑠收到计算任务，向申请VEC服务的网络运营商发送卸载请求。收到请求后，网络运营商给出VEC服务提供的报价。作为反馈，𝑉𝑠相应地提供其可接受的价格𝜋𝑖。商定的价格将在足够多轮的协商迭代后达成，否则，卸载请求将被网络运营商拒绝。通过这一过程，网络运营商的收入Φ将达到最大化。为了验证算法的可行性，我们先将𝐷𝑇中AVs的数量设置为2个，然后将其分别增加到10个和100个，以比较本文方法与所选其他算法的运行性能。分配的带宽𝑤将相应地计算。其他参数见表一。
## B.性能与分析
- 首先对达到卸载策略最优解的gtos(算法1)进行评估，然后对GTO-MFV(算法2)进行评估，以确保求解过程更加有效和高效。然后，对TL-FSCU(算法3)进行了评估，显示了VEC中卸载优化问题可扩展性的提高。
1. 网络运营商的收益：图4为车辆与网络运营商博弈理论博弈获得的网络运营商收益表现。值得注意的是，随着第42组的迭代，收益将增长到2100便士。在此之后，网络运营商的收入急剧下降，这意味着数据卸载量越大或服务价格越高都不会提高网络运营商的收入。实验表明，存在一个满足网络运营商和边缘AV平衡策略的点。
<img width="485" alt="图4" src="https://user-images.githubusercontent.com/121794362/228581144-5c897101-472d-4f7f-8dcc-92d73f376600.png">
2. 构建的神经网络对博弈理论模型的验证：图5博弈论模型中分布𝑝的KL散度和所提出的GTO-MFV的𝑞。𝑞表示𝑝的后验分布的变分近似。我们可以看到，两条线在105次迭代时收敛，这表明构造的GTO-MFV与GTOS等价。因此，两种公式分布之间的差异可以忽略。换句话说，GTO-MFV可以看作是GTOS过程的替代解，从而克服了传统方法求解博弈理论卸载模型的计算复杂度和能耗高的局限性。
<img width="423" alt="图5" src="https://user-images.githubusercontent.com/121794362/228582324-950b6c0a-3107-4b9a-ac90-942bf05ff571.png">
3. GTOS与GTO-MFV的成本比较：图6展示了GTOS与构建的GTO-MFV求解博弈论模型的成本比较。很明显，使用GTOS和GTO-MFV进行模型求解的成本在不断增加。然而，GTO-MFV的成本增长缓慢，而GTO-MFV的成本增长缓慢。造成这种差异的原因是，由于GTO-MFV是通过近似推理构造的，传统方法中启发式搜索的连续迭代比学习过程消耗更多的能量。因此，与GTOS相比，GTO-MFV在求解博弈模型时产生的成本降低了。
<img width="498" alt="图6" src="https://user-images.githubusercontent.com/121794362/228582706-74de3c52-5b01-49a5-a9e4-6901946c4e3b.png">
4. TL-FSCU的精度：为了展示所提出的TL-FSCU在VEC可扩展的卸载优化方面的优势，将TL-FSCU与现有算法进行比较。图7显示了所构建TL-FSCU在精度方面的优势。
<img width="489" alt="图7" src="https://user-images.githubusercontent.com/121794362/228583250-36d78cc8-0d0a-4746-bffb-94e7dc5a328f.png">
5. 提出的TL-FSCU的特征更新率：图8比较了四种算法的特征更新率。很明显，TL-FSCU在特征更新率上呈现出较小的比例，这意味着使用该方法进行可扩展优化时，需要更新到传输目的地的特征数量最少，节约了更多的资源。因为TL-FSCU虽然在完全更新之前考虑了所选特征与比较特征的相似度，但一旦相似度得到确认，则不会更新特征。
<img width="478" alt="图8" src="https://user-images.githubusercontent.com/121794362/228583855-5dd0160e-4dfc-46e9-891e-935e870ef0d8.png">
6.提出的TL-FSCU的运行性能：表2显示了所选三种算法和提出的TL-FSCU的运行性能。从结果可以看出，TL-FSCU在过程中的时间成本是最低的。这是因为所提出的TL-FSCU通过高效的基于特征的迁移学习方法节省了额外的时间。对于同一特征组的卸载决策策略，TL-FSCU能够识别是保持相同的卸载策略还是快速更新特征。TL-FSCU的时间成本几乎是iCaRL和JFSSL所需时间的一半。所提出的TL-FSCU能够在VEC中快速实现博弈理论卸载的可扩展优化。
<img width="468" alt="表2" src="https://user-images.githubusercontent.com/121794362/228584173-5dceebe6-3329-408a-a140-f6dea29f566d.png">

# 结论
- 在本文中，我们提出了一种新的基于神经网络的迁移学习方法来实现VEC中的可扩展卸载。采用博弈模型(GTOS)确定卸载策略。为了降低博弈过程中持续迭代所带来的计算复杂度和能量消耗，提高卸载在不断变化的VEC环境下的可扩展性，提出了有效求解GTOS的博弈理论卸载平均场变分过程(GTO-MFV)。具有特征选择、比较和更新的迁移学习框架(TL-FSCU)旨在进一步增强在面对新的、不可见的VEC环境时的卸载优化的可拓展性。实验结果表明，TL-FSCU在更新率和准确率方面比现有的iCaRL、LwF和JFSSL等框架和算法有更好的性能。
